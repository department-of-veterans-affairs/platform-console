<div class="font-sans antialiased h-screen flex" data-controller="slack">
	<div class="bg-indigo-darker text-sm text-purple-lighter px-6 py-3 flex-none w-64 pb-6 md:block">
		<div class="mb-8">
				<div class="px-2 mb-2 text-white flex justify-between items-center">
						<div class="opacity-75">Channels</div>
				</div>
				<% @channels.each do |channel| %>
					<div class="bg-teal-dark py-1 px-4 text-white">
						# <%= link_to channel.name, slack_index_path(channel_id: channel.id) %>
					</div>
				<% end %>
		</div>
	</div>

	<!-- Chat content -->
	<div class="flex-1 flex flex-col bg-white overflow-hidden">
		<!-- Top bar -->
		<div class="border-b flex px-6 py-2 items-center flex-none">
				<div class="flex flex-col">
						<h3 class="text-grey-darkest mb-1 font-extrabold" data-slack-target="channel" id="<%= @channel.id %>"># <%= @channel.name %></h3>
						<div class="text-grey-dark text-sm truncate">
								<%= @channel.purpose.value %>
						</div>
				</div>
				<div class="ml-auto hidden md:block">
						<div class="relative">
								<input type="search" placeholder="Search" class="appearance-none border border-grey rounded-lg pl-8 pr-4 py-2">
								<div class="absolute pin-y pin-l pl-3 flex items-center justify-center">
										<svg class="fill-current text-grey h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
												<path d="M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z" />
										</svg>
								</div>
						</div>
				</div>
		</div>
		<!-- Chat messages -->
		<div class="px-6 py-4 flex-1 overflow-y-scroll">
			<!-- A message -->

			<% @messages.each do |message| %>
				<% user = @slack_client.users_info(user: message.user).user %>
				<div class="flex items-start mb-4 text-sm">
						<img src="<%= user.profile.image_24 %>" class="w-10 h-10 rounded mr-3">
						<div class="px-1 flex-1 overflow-hidden">
							<div>
								<span class="font-bold"><%= user.real_name %> </span>
								<% time = Time.at(message.ts.to_i) %>
								<% days_ago = "#{time.day} days ago" %>
								<span class="text-grey text-xs"><%= time < 1.day.ago ? days_ago : time.strftime("%I:%M %p") %></span>
							</div>
							<% if message.text.include?("<@") %>
								<% tagged_user = @slack_client.users_info(user: message.text.split(">")[0].gsub("<@", '')).user.real_name %>
								<% message_text = message.text.split(">")[1] %>
								<p class="text-black leading-normal"><%= "#{tagged_user} #{message_text}" %></p>
							<% else %>
								<p class="text-black leading-normal"><%= message.text %></p>
							<% end %>
							<% if message.reply_count.to_i > 0 %>
								<div class="text-xs text-purple-lighter">
									<strong><%= pluralize(message.reply_count, "reply") %></strong> View thread
								</div>
							<% end %>
						</div>
				</div>
			<% end %>
		</div>

		<div class="pb-6 px-4 flex-none">
			<div class="flex rounded-lg border-2 border-grey overflow-hidden">
					<span class="text-3xl text-grey border-r-2 border-grey p-2">
						<svg class="fill-current h-6 w-6 block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M16 10c0 .553-.048 1-.601 1H11v4.399c0 .552-.447.601-1 .601-.553 0-1-.049-1-.601V11H4.601C4.049 11 4 10.553 4 10c0-.553.049-1 .601-1H9V4.601C9 4.048 9.447 4 10 4c.553 0 1 .048 1 .601V9h4.399c.553 0 .601.447.601 1z"/></svg>
					</span>
					<%= form_with url: '/slack', method: :post, class: "w-full px-4" do |form| %>
						<%= form.hidden_field :channel, value: @channel.name %>
						<%= form.text_field :message, class: "w-full px-4", "data-action": "keyup->slack#sendMessage" %>
					<% end %>
			</div>
		</div>
	</div>
</div>
